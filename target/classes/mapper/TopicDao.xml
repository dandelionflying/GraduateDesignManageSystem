<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.running4light.gdms.dao.TopicDao">

	<resultMap id="BaseResultMap" type="com.running4light.gdms.pojo.Topic">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="ID" jdbcType="VARCHAR" property="id" />
    <result column="TOPIC_NAME" jdbcType="VARCHAR" property="topicName" />
    <result column="TEACHER_NAME" jdbcType="VARCHAR" property="teacherName" />
    <result column="CONTENT" jdbcType="VARCHAR" property="content" />
    <result column="DEMAND" jdbcType="VARCHAR" property="demand" />
    <result column="TOPIC_TYPE" jdbcType="VARCHAR" property="topicType" />
    <result column="STATE" jdbcType="VARCHAR" property="state" />
    <result column="TAG" jdbcType="INTEGER" property="tag" />
    <result column="UPLOAD_TIME" jdbcType="TIMESTAMP" property="uploadTime" />
  </resultMap>
  <parameterMap type="com.running4light.gdms.pojo.SearchTopicParameter1" id="Parameter1">
      <parameter property="tag" jdbcType="INTEGER"/>
      <parameter property="key" jdbcType="VARCHAR"/>
  </parameterMap>
  <parameterMap type="com.running4light.gdms.pojo.SearchTopicParameter2" id="Parameter2">
      <parameter property="tag" jdbcType="INTEGER"/>
      <parameter property="key" jdbcType="VARCHAR"/>
      <parameter property="topicType" jdbcType="VARCHAR"/>
  </parameterMap>
    <select id="queryById" parameterType="java.lang.String" resultMap="BaseResultMap">
        select * from topic where ID = #{id}
    </select>
	<update id="updateByPrimaryKey" parameterType="com.running4light.gdms.pojo.Topic">
		update topic
		<trim prefix="set" suffixOverrides=",">
	        <if test="topicName!=null">TOPIC_NAME=#{topicName},</if>
	        <if test="teacherName!=null">TEACHER_NAME=#{teacherName},</if>
	        <if test="content!=null">CONTENT=#{content},</if>
	        <if test="demand!=null">DEMAND=#{demand},</if>
	        <if test="topicType!=null">TOPIC_TYPE=#{topicType},</if>
	        <if test="state!=null">STATE=#{state},</if>
	        <if test="tag!=null">TAG=#{tag},</if>
	        <if test="uploadTime!=null">UPLOAD_TIME=#{uploadTime},</if>
		</trim>
		
		where ID = #{id,jdbcType=VARCHAR}
	
	</update>
<!-- 		set TOPIC_NAME = #{topicName,jdbcType=VARCHAR},
		TEACHER_NAME = #{teacherName,jdbcType=VARCHAR},
		CONTENT = #{content,jdbcType=VARCHAR},
		DEMAND = #{demand,jdbcType=VARCHAR},
		TOPIC_TYPE = #{topicType,jdbcType=VARCHAR},
		STATE = #{state,jdbcType=VARCHAR},
		TAG = #{tag,jdbcType=INTEGER},
		UPLOAD_TIME = #{uploadTime,jdbcType=TIMESTAMP} -->
    <select id="queryTopicByTeacherName" parameterType="map" resultMap="BaseResultMap">
        select * from topic where teacher_name = #{teacherName} limit #{index},#{page}
    </select>
	<select id="queryAllTopic" resultType="com.running4light.gdms.pojo.Topic">
		select * from topic;
	</select>
	<select id="queryTopicByName" parameterType="string" resultType="com.running4light.gdms.pojo.Topic">
		select * from topic where topicname = #{topicName}
	</select>
	<insert id="addTopic" parameterType="com.running4light.gdms.pojo.Topic">
		<selectKey keyProperty="id" order="AFTER" resultType="java.lang.String">
      SELECT LAST_INSERT_ID()
    </selectKey>
	    insert into topic (ID,TOPIC_NAME, TEACHER_NAME, CONTENT, 
	      DEMAND, TOPIC_TYPE, STATE, 
	      TAG, UPLOAD_TIME)
	    values (#{id,jdbcType=VARCHAR},#{topicName,jdbcType=VARCHAR}, #{teacherName,jdbcType=VARCHAR}, #{content,jdbcType=VARCHAR}, 
	      #{demand,jdbcType=VARCHAR}, #{topicType,jdbcType=VARCHAR}, #{state,jdbcType=VARCHAR}, 
	      #{tag,jdbcType=INTEGER}, #{uploadTime,jdbcType=TIMESTAMP})
	</insert>
	<select id="queryContentById" parameterType="string" resultType="java.lang.String">
	    select content from topic where id = #{topicId}
	</select>
	<select id="queryTopicNameByStudentId" parameterType="string" resultType="java.lang.String">
	    select topic_name from topic where id = (select topic_id from st where s_id = #{id})
	</select>
	<select id="queryTopicByStudentId" resultMap="BaseResultMap" parameterType="map">
	    select * from topic where id = (select topic_id from st where s_id = #{uid})
	</select>
	<select id="queryTopicByKey" parameterType="map" resultType="com.running4light.gdms.pojo.Topic">
	    select * from topic where tag = #{tag} and topic_name like CONCAT('%',#{key},'%') limit #{index},#{page}
	</select>
	<select id="countTopicByKey" parameterType="map" resultType="java.lang.Integer">
	    select count(*) from topic where tag = #{tag} and topic_name like CONCAT('%',#{key},'%')
	</select>
	<select id="queryTop10Key" resultType="java.lang.String">
	    select key_name from searchs order by weight desc,times desc limit 0,10
	</select>
	<update id="updateHotKey" parameterType="java.lang.String">
	    update searchs set times = times+1 where key_name = #{keyName}
	</update>
	<select id="queryKeyByName" resultType="java.lang.String">
	    select key_name from searchs where key_name = #{keyName}
	</select>
	<insert id="insertHotKey">
	    insert into searchs (key_name) values(#{keyName});
	</insert>
	<select id="queryTopicByTag" parameterType="int" resultType="com.running4light.gdms.pojo.Topic">
        select * from topic where tag = #{tag}
    </select>
    <update id="updateTagById" parameterType="int">
        update topic set tag = #{tag} where id = #{id}
    </update>
    <select id="queryNameOrderById" resultType="java.lang.String">
        select name from topicclassify order by id;
    </select>
    <select id="queryPageByTagAndName" parameterType="map" resultMap="BaseResultMap" >
        select * 
        from topic 
        where tag = #{tag} and topic_name like CONCAT('%',#{key},'%')
        limit #{index},#{page}
    </select>
    <select id="countTopicByTagAndName" parameterType="map" resultType="java.lang.Integer">
        select count(*) 
        from topic 
        where tag = #{tag} and topic_name like CONCAT('%',#{key},'%')
    </select>
    <!-- <select id="queryTopicByTagAndNameAndType" parameterType="com.running4light.gdms.pojo.SearchTopicParameter2" resultType="com.running4light.gdms.pojo.Topic">
        select * from topic where tag = #{tag} and topic_type = #{classify} and topic_name like CONCAT('%',#{key},'%');
    </select> -->
    <select id="queryPageByTag" parameterType="map" resultMap="BaseResultMap">
        select * 
        from topic
        where tag = #{tag} limit #{index},#{page}
    </select>
    <select id="countTopicByTag" resultType="java.lang.Integer" parameterType="java.lang.Integer">
        select count(*)
        from topic
        where tag = #{tag}
    </select>
    <select id="countTopicByTeacherName" parameterType="map" resultType="java.lang.Integer">
        select count(*) from topic where teacher_name = #{teacherName}
    </select>
    
    <select id="queryPageByTagAndNameAndType" parameterType="map" resultMap="BaseResultMap">
        select * 
        from topic 
        where tag = #{tag} and topic_type = #{classify} and topic_name like CONCAT('%',#{key},'%')
        limit #{index},#{page}
    </select>
    <select id="countTopicByTagAndNameAndKey" parameterType="map" resultType="java.lang.Integer">
        select count(*) 
        from topic 
        where tag = #{tag} and topic_type = #{classify} and topic_name like CONCAT('%',#{key},'%')
    </select>
    
    <select id="queryNameById" parameterType="map" resultType="java.lang.String">
        select topic_name from topic where id = #{id}
    </select>
    <select id="queryTeacherNameById" parameterType="map" resultType="java.lang.String">
        select teacher_name from topic where id = #{id}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
	    delete from topic
	    where ID = #{id,jdbcType=VARCHAR}
  </delete>
  
	<update id="updateByTag" parameterType="java.lang.Integer">
	    update topic set TAG = #{tag} where TAG = 0
	</update>
</mapper>